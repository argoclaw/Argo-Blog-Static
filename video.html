<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading... | YT Archive</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.15.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.15.4/dist/browser/index.js"></script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <style>
        :root { --bg-primary: #0a0a0b; --bg-secondary: #111113; --bg-card: #161618; --text-primary: #e8e8e8; --text-secondary: #888; --text-muted: #777; --accent-cyan: #00d4aa; --accent-cyan-dim: #00a080; --border-subtle: #252528; --shadow-card: 0 4px 20px rgba(0,0,0,0.3); }
        [data-theme="light"] { --bg-primary: #f8f6f3; --bg-secondary: #fdfcfa; --bg-card: #ffffff; --text-primary: #1a1a1a; --text-secondary: #555; --text-muted: #888; --accent-cyan: #00997a; --border-subtle: #e8e5e0; --shadow-card: 0 2px 12px rgba(0,0,0,0.06); }
        @media (prefers-color-scheme: light) { :root:not([data-theme="dark"]) { --bg-primary: #f8f6f3; --bg-secondary: #fdfcfa; --bg-card: #ffffff; --text-primary: #1a1a1a; --text-secondary: #555; --accent-cyan: #00997a; --border-subtle: #e8e5e0; } }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'IBM Plex Mono', monospace; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        body::before { content: ''; position: fixed; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); opacity: 0.03; pointer-events: none; z-index: 1000; }
        .grid-bg { position: fixed; inset: 0; background-image: linear-gradient(var(--border-subtle) 1px, transparent 1px), linear-gradient(90deg, var(--border-subtle) 1px, transparent 1px); background-size: 60px 60px; opacity: 0.15; pointer-events: none; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 40px; position: relative; z-index: 1; }
        .header { padding: 30px 0; border-bottom: 1px solid var(--border-subtle); margin-bottom: 40px; display: flex; justify-content: space-between; align-items: center; }
        .back-link { display: flex; align-items: center; gap: 12px; color: var(--text-secondary); text-decoration: none; font-size: 13px; }
        .back-link:hover { color: var(--accent-cyan); }
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text-primary); }
        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-cyan), var(--accent-cyan-dim)); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .logo-text { font-family: 'Instrument Serif', serif; font-size: 20px; }
        .logo-text span { color: var(--accent-cyan); }
        .theme-btn { width: 36px; height: 36px; background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: 4px; color: var(--text-secondary); font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .theme-btn:hover { background: var(--accent-cyan); color: var(--bg-primary); }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .video-header { display: grid; grid-template-columns: 1.2fr 1fr; gap: 40px; margin-bottom: 50px; }
        .video-embed { aspect-ratio: 16/9; background: #000; border-radius: 8px; overflow: hidden; box-shadow: var(--shadow-card); }
        .video-embed iframe { width: 100%; height: 100%; border: none; }
        .video-embed.x-embed { aspect-ratio: unset; min-height: unset; height: auto; background: var(--bg-secondary); display: block; padding: 20px; }
        .video-embed.x-embed iframe { width: 100%; min-height: 650px; border: none; }
        .video-embed.x-embed .twitter-tweet { margin: 0 auto !important; }
        .video-meta { display: flex; flex-direction: column; justify-content: center; }
        .video-channel { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
        .channel-avatar { width: 32px; height: 32px; background: rgba(0,212,170,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; color: var(--accent-cyan); font-weight: 600; }
        .channel-name { font-size: 13px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .video-title { font-family: 'Instrument Serif', serif; font-size: 32px; font-weight: 400; line-height: 1.3; margin-bottom: 20px; }
        .video-stats { display: flex; flex-wrap: wrap; gap: 20px; font-size: 13px; color: var(--text-muted); margin-bottom: 24px; }
        .video-stats-grid { display: flex; gap: 30px; padding: 20px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-subtle); }
        .stat-item { text-align: center; }
        .stat-value { font-size: 24px; font-weight: 600; color: var(--text-primary); }
        .stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
        .summary-container { margin-bottom: 60px; }
        .tldr-box { font-family: 'Instrument Serif', serif; font-size: 20px; font-style: italic; color: var(--text-secondary); padding: 24px 30px; background: var(--bg-secondary); border-left: 4px solid var(--accent-cyan); margin-bottom: 40px; line-height: 1.7; border-radius: 0 8px 8px 0; }
        .viz-container { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 24px; margin-bottom: 30px; box-shadow: var(--shadow-card); }
        .viz-title { font-size: 14px; font-weight: 600; color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        #mindmap-svg { width: 100%; height: 400px; }
        .comparison-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .comparison-table th { background: var(--bg-secondary); padding: 12px 16px; text-align: left; font-weight: 600; border-bottom: 2px solid var(--accent-cyan); }
        .comparison-table td { padding: 12px 16px; border-bottom: 1px solid var(--border-subtle); }
        .comparison-table tr:hover td { background: rgba(0,212,170,0.05); }
        .mermaid { background: transparent !important; }
        .stats-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 30px; }
        .stats-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 20px; text-align: center; box-shadow: var(--shadow-card); }
        .stats-card-value { font-size: 28px; font-weight: 700; color: var(--accent-cyan); margin-bottom: 8px; }
        .stats-card-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .timeline-container { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 24px; margin-bottom: 30px; }
        .timeline-title { font-size: 14px; font-weight: 600; color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
        .timeline-track { position: relative; height: 60px; background: var(--bg-secondary); border-radius: 4px; margin-bottom: 16px; }
        .timeline-bar { position: absolute; top: 50%; left: 20px; right: 20px; height: 2px; background: var(--border-subtle); transform: translateY(-50%); }
        .timeline-point { position: absolute; top: 50%; width: 12px; height: 12px; background: var(--accent-cyan); border-radius: 50%; transform: translate(-50%, -50%); cursor: pointer; transition: all 0.2s; z-index: 2; }
        .timeline-point:hover { transform: translate(-50%, -50%) scale(1.5); box-shadow: 0 0 12px var(--accent-cyan); }
        .timeline-labels { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); padding: 0 20px; }
        .timeline-tooltip { position: fixed; max-width: 300px; padding: 12px 16px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 6px; font-size: 13px; box-shadow: 0 8px 30px rgba(0,0,0,0.3); z-index: 1001; pointer-events: none; opacity: 0; transition: opacity 0.15s; }
        .timeline-tooltip.visible { opacity: 1; }
        .timeline-tooltip-time { font-size: 11px; color: var(--accent-cyan); margin-bottom: 6px; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .summary-section { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 8px; padding: 24px; box-shadow: var(--shadow-card); }
        .summary-section h2 { font-size: 14px; font-weight: 600; color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px dashed var(--border-subtle); }
        .summary-list { list-style: none; }
        .summary-list li { padding: 12px 0; border-bottom: 1px solid var(--border-subtle); font-size: 14px; line-height: 1.7; }
        .summary-list li:last-child { border-bottom: none; }
        .timestamp-link { color: var(--accent-cyan); text-decoration: none; font-size: 11px; margin-left: 8px; cursor: pointer; padding: 6px 10px; background: rgba(0,212,170,0.1); border-radius: 4px; border: none; }
        .timestamp-link:hover { background: rgba(0,212,170,0.2); }
        .takeaway-section { grid-column: 1 / -1; }
        .takeaway-box { background: linear-gradient(135deg, rgba(0,212,170,0.07), rgba(0,212,170,0.03)); border: 1px solid rgba(0,212,170,0.2); padding: 24px; border-radius: 8px; font-size: 16px; line-height: 1.7; }
        .empty-summary { text-align: center; padding: 80px 40px; background: var(--bg-card); border: 1px dashed var(--border-subtle); border-radius: 8px; }
        .empty-icon { font-size: 48px; margin-bottom: 20px; opacity: 0.3; }
        .empty-title { font-family: 'Instrument Serif', serif; font-size: 24px; margin-bottom: 10px; color: var(--text-secondary); }
        footer { padding: 40px 0; border-top: 1px solid var(--border-subtle); display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); }
        .footer-brand { display: flex; align-items: center; gap: 8px; }
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; color: var(--text-muted); }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid var(--border-subtle); border-top-color: var(--accent-cyan); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-state { text-align: center; padding: 100px 40px; }
        @media (max-width: 900px) { .container { padding: 0 20px; } .video-header { grid-template-columns: 1fr; } .video-title { font-size: 24px; } .summary-grid { grid-template-columns: 1fr; } .takeaway-section { grid-column: 1; } }
    </style>
</head>
<body>
    <div class="grid-bg"></div>
    <div class="container">
        <header class="header">
            <a href="./" class="back-link">‚Üê Back to Archive</a>
            <div class="header-right">
                <a href="./" class="logo"><div class="logo-icon">‚öì</div><div class="logo-text">YT <span>Archive</span></div></a>
                <button class="theme-btn" id="theme-toggle" aria-label="Toggle theme"><span class="theme-icon">‚òÄÔ∏è</span></button>
            </div>
        </header>
        <main id="content"><div class="loading"><div class="loading-spinner"></div><span>Loading video...</span></div></main>
        <footer><div class="footer-brand"><span>‚öì</span><span>Powered by Argo ¬∑ OpenClaw</span></div></footer>
    </div>
    <div class="timeline-tooltip" id="tooltip"></div>
    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'dark', themeVariables: { primaryColor: '#00d4aa', primaryTextColor: '#e8e8e8', lineColor: '#888', secondaryColor: '#161618' }});
        const DATA_URL = '/yt/data/videos.json';
        let currentVideoId = null, videoDuration = 0;

        function getPreferredTheme() { const s = localStorage.getItem('yt-archive-theme'); return s || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark'); }
        function setTheme(t) { document.documentElement.setAttribute('data-theme', t); localStorage.setItem('yt-archive-theme', t); document.querySelector('.theme-icon').textContent = t === 'light' ? 'üåô' : '‚òÄÔ∏è'; }
        function toggleTheme() { setTheme((document.documentElement.getAttribute('data-theme') || getPreferredTheme()) === 'light' ? 'dark' : 'light'); }
        setTheme(getPreferredTheme());
        document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);

        function getVideoIdFromUrl() {
            // Try path first: /yt/<videoId>
            const pathMatch = window.location.pathname.match(/\/yt\/([a-zA-Z0-9_-]+)$/);
            if (pathMatch) return pathMatch[1];
            // Fallback to query string: ?v=<videoId>
            return new URLSearchParams(window.location.search).get('v');
        }
        function formatDuration(s) { if (!s) return '--:--'; const h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sec = s%60; return h > 0 ? `${h}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}` : `${m}:${String(sec).padStart(2,'0')}`; }
        function formatNumber(n) { if (!n) return '--'; return n >= 1e6 ? (n/1e6).toFixed(1)+'M' : n >= 1e3 ? (n/1e3).toFixed(1)+'K' : String(n); }
        function formatDate(ts) { return ts ? new Date(ts).toLocaleDateString('zh-CN',{year:'numeric',month:'long',day:'numeric'}) : '--'; }
        function formatTimestamp(s) { return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`; }
        function seekTo(sec) { const f = document.getElementById('youtube-player'); if (f && currentVideoId && !currentVideoId.match(/^\d{19,}$/)) f.src = `https://www.youtube.com/embed/${currentVideoId}?start=${sec}&autoplay=1`; }
        function isXVideo(v) { const url = v.source_url || (v.summary && v.summary.source_url); return (url && (url.includes('x.com') || url.includes('twitter.com'))) || (v.id && v.id.match(/^\d{19,}$/)); }
        function getXStatusId(v) { const url = v.source_url || (v.summary && v.summary.source_url); if (url) { const m = url.match(/status\/(\d+)/); if (m) return m[1]; } return null; }
        function getSourceUrl(v) { return v.source_url || (v.summary && v.summary.source_url) || null; }

        function renderMindmap(data) {
            if (!data || !data.root) return '';
            function toMd(n, lvl=0) {
                let md = '#'.repeat(lvl+1) + ' ' + (typeof n === 'string' ? n : n.label || n.root) + '\n';
                (n.children || []).forEach(c => md += toMd(c, lvl+1));
                return md;
            }
            const md = toMd(data), id = 'mm-' + Date.now();
            setTimeout(() => {
                try {
                    const { Transformer, Markmap } = window.markmap;
                    const tf = new Transformer();
                    const { root } = tf.transform(md);
                    Markmap.create(document.getElementById(id), { colorFreezeLevel: 2, initialExpandLevel: 3 }, root);
                } catch(e) { console.error('Mindmap error:', e); }
            }, 100);
            return `<div class="viz-container"><div class="viz-title">üß† Mind Map</div><svg id="${id}" style="width:100%;height:400px;"></svg></div>`;
        }

        function renderComparison(d) {
            if (!d || !d.headers || !d.rows) return '';
            return `<div class="viz-container"><div class="viz-title">üìä ${d.title||'Comparison'}</div><table class="comparison-table"><thead><tr>${d.headers.map(h=>`<th>${h}</th>`).join('')}</tr></thead><tbody>${d.rows.map(r=>`<tr>${r.map(c=>`<td>${c}</td>`).join('')}</tr>`).join('')}</tbody></table></div>`;
        }

        function renderFlowchart(d) {
            if (!d || !d.mermaid) return '';
            const id = 'fc-' + Date.now();
            // Fix escaped newlines from JSON storage
            const mermaidCode = d.mermaid.replace(/\\n/g, '\n');
            setTimeout(() => { try { mermaid.run({ nodes: [document.getElementById(id)] }); } catch(e) { console.error('Mermaid error:', e); } }, 100);
            return `<div class="viz-container"><div class="viz-title">üîÑ ${d.title||'Flow'}</div><pre class="mermaid" id="${id}">${mermaidCode}</pre></div>`;
        }

        function renderStats(d) {
            if (!d || !d.length) return '';
            return `<div class="stats-dashboard">${d.map(s=>`<div class="stats-card"><div class="stats-card-value">${s.value}</div><div class="stats-card-label">${s.label}</div></div>`).join('')}</div>`;
        }

        function renderTimeline(ideas, dur) {
            if (!ideas || ideas.length < 3 || !dur) return '';
            const ts = ideas.filter(i => typeof i === 'object' && i.timestamp != null);
            if (ts.length < 3) return '';
            return `<div class="timeline-container"><div class="timeline-title">üìç Ideas Timeline</div><div class="timeline-track"><div class="timeline-bar"></div>${ts.map(i=>`<div class="timeline-point" style="left:calc(20px + (100% - 40px)*${i.timestamp/dur})" data-time="${i.timestamp}" data-text="${(i.text||'').replace(/"/g,'&quot;')}" onclick="seekTo(${i.timestamp})"></div>`).join('')}</div><div class="timeline-labels"><span>0:00</span><span>${formatDuration(dur)}</span></div></div>`;
        }

        function renderVideo(v) {
            currentVideoId = v.id; videoDuration = v.duration || 0;
            document.title = `${v.title||'Video'} | YT Archive`;
            const s = v.summary || {}, viz = s.viz_data || {};
            let html = '';
            if (Object.keys(s).length > 0) {
                const tldr = s.tldr ? `<div class="tldr-box">${s.tldr}</div>` : '';
                let visuals = '';
                if (viz.mindmap) visuals += renderMindmap(viz.mindmap);
                if (viz.stats && viz.stats.length) visuals += renderStats(viz.stats);
                if (viz.comparison) visuals += renderComparison(viz.comparison);
                if (viz.flowchart) visuals += renderFlowchart(viz.flowchart);
                if (!viz.mindmap && s.ideas && s.ideas.length >= 3) visuals += renderTimeline(s.ideas, videoDuration);
                let sections = '';
                if (s.ideas && s.ideas.length) sections += `<section class="summary-section"><h2>üí° Ideas</h2><ul class="summary-list">${s.ideas.map(i=>{const t=typeof i==='string'?i:i.text,ts=typeof i==='object'?i.timestamp:null;return `<li>${t}${ts!=null?`<button class="timestamp-link" onclick="seekTo(${ts})">${formatTimestamp(ts)}</button>`:''}</li>`;}).join('')}</ul></section>`;
                if (s.insights && s.insights.length) sections += `<section class="summary-section"><h2>üß† Insights</h2><ul class="summary-list">${s.insights.map(i=>`<li>${typeof i==='string'?i:i.text}</li>`).join('')}</ul></section>`;
                if (s.quotes && s.quotes.length) sections += `<section class="summary-section"><h2>üó£Ô∏è Quotes</h2><ul class="summary-list">${s.quotes.map(q=>`<li>"${typeof q==='string'?q:q.text}"</li>`).join('')}</ul></section>`;
                if (s.facts && s.facts.length) sections += `<section class="summary-section"><h2>üß™ Facts</h2><ul class="summary-list">${s.facts.map(f=>`<li>${typeof f==='string'?f:f.text}</li>`).join('')}</ul></section>`;
                if (s.takeaway) sections += `<section class="summary-section takeaway-section"><h2>üöÄ Takeaway</h2><div class="takeaway-box">${s.takeaway}</div></section>`;
                html = `<div class="summary-container">${tldr}${visuals}<div class="summary-grid">${sections}</div></div>`;
            } else {
                html = `<div class="empty-summary"><div class="empty-icon">üì≠</div><h2 class="empty-title">No summary available</h2><p class="empty-desc">This video was recorded but no summary was saved.</p></div>`;
            }
            // Render embed based on platform
            let embedHtml = '';
            if (isXVideo(v)) {
                const statusId = getXStatusId(v) || v.id;
                // Use container for Twitter widget to render into
                embedHtml = `<div class="video-embed x-embed" id="x-embed-container"></div>`;
            } else {
                embedHtml = `<div class="video-embed"><iframe id="youtube-player" src="https://www.youtube.com/embed/${v.id}?enablejsapi=1&rel=0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
            }
            document.getElementById('content').innerHTML = `
                <div class="video-header">
                    ${embedHtml}
                    <div class="video-meta">
                        <div class="video-channel"><div class="channel-avatar">${(v.channel||'?').charAt(0).toUpperCase()}</div><div class="channel-name">${v.channel||'Unknown'}</div></div>
                        <h1 class="video-title">${v.title||'Untitled'}</h1>
                        <div class="video-stats"><span>üìÖ ${formatDate(v.analyzed_at)}</span><span>‚è±Ô∏è ${formatDuration(v.duration)}</span>${getSourceUrl(v) ? `<span><a href="${getSourceUrl(v)}" target="_blank" style="color:var(--accent-cyan);">üîó Source</a></span>` : ''}</div>
                        <div class="video-stats-grid">
                            <div class="stat-item"><div class="stat-value">${formatNumber(v.view_count)}</div><div class="stat-label">Views</div></div>
                            <div class="stat-item"><div class="stat-value">${formatNumber(v.like_count)}</div><div class="stat-label">Likes</div></div>
                            <div class="stat-item"><div class="stat-value">${v.insights_count||'--'}</div><div class="stat-label">Insights</div></div>
                        </div>
                    </div>
                </div>${html}`;
            // X embeds: use twttr.widgets.createTweet for auto-sizing
            if (isXVideo(v)) {
                const statusId = getXStatusId(v) || v.id;
                const container = document.getElementById('x-embed-container');
                const theme = (document.documentElement.getAttribute('data-theme') || getPreferredTheme()) === 'dark' ? 'dark' : 'light';
                
                function renderTweet() {
                    if (window.twttr && window.twttr.widgets) {
                        window.twttr.widgets.createTweet(statusId, container, {
                            theme: theme,
                            dnt: true,
                            align: 'center'
                        });
                    } else {
                        setTimeout(renderTweet, 200);
                    }
                }
                renderTweet();
            }
            document.querySelectorAll('.timeline-point').forEach(pt => {
                pt.addEventListener('mouseenter', e => { const tip = document.getElementById('tooltip'); tip.innerHTML = `<div class="timeline-tooltip-time">${formatTimestamp(parseInt(pt.dataset.time))}</div>${pt.dataset.text}`; tip.style.left = e.pageX+10+'px'; tip.style.top = e.pageY+10+'px'; tip.classList.add('visible'); });
                pt.addEventListener('mouseleave', () => document.getElementById('tooltip').classList.remove('visible'));
            });
        }

        function renderError() { document.title = 'Not Found | YT Archive'; document.getElementById('content').innerHTML = `<div class="error-state"><div class="empty-icon">üîç</div><h2 class="empty-title">Video not found</h2></div>`; }

        async function loadVideo() {
            const vid = getVideoIdFromUrl();
            if (!vid) return renderError();
            try {
                const res = await fetch(DATA_URL + '?t=' + Date.now());
                const data = await res.json();
                const video = (data.videos||[]).find(v => v.id === vid);
                video ? renderVideo(video) : renderError();
            } catch(e) { console.error(e); renderError(); }
        }
        loadVideo();
    </script>
</body>
</html>